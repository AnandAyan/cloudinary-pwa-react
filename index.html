<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cloudinary Progressive Web App React</title>
    <script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>
    <script src="https://unpkg.com/lodash@4.17.4/lodash.js"></script>
    <script src="https://unpkg.com/react@15.3.1/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15.3.1/dist/react-dom.min.js"></script>
    <script src="https://unpkg.com/cloudinary-core@2.3.0/cloudinary-core.js"></script>
    <script src="https://unpkg.com/cloudinary-react@1.0.3/dist/cloudinary-react.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
</head>
<body>
<div id="app-root"></div>
<script type="text/babel">
    let Image = cloudinaryReact.Image;
    class NavBar extends React.Component {
      render() {
        return <nav>
          <div className="nav-wrapper">
            <a href="/" className="brand-logo">
              <Image cloudName="elsmore-me" title="Cloudinary Demo" publicId="cloudinary_logo" width="200" crop="scale"/>
            </a>
          </div>
        </nav>;
      }
    }
    class SiteFooter extends React.Component {
      render() {
        return <footer className="page-footer">
          <div className="container">
            <div className="row">
              <div className="col l6 s12">
                <h5 className="white-text">Angular 2 Progressive Web App Demo</h5>
                <p className="grey-text text-lighten-4">See how to super charge your Angular 2 app by following the tenets of Progressive Web Apps and using service worker progressively.</p>
              </div>
            </div>
          </div>
          <div className="footer-copyright">
            <div className="container">
            Â© 2017 Copyright Cloudinary
            <a className="grey-text text-lighten-4 right" href="https://elsmore.me">Made with &#9829; by Mike Elsmore</a>
            </div>
          </div>
        </footer>;
      }
    }
    class PhotoThumb extends React.Component {
      render() {
        var viewDetails = "/view/" + this.props.publicId;
        return <div className="card hoverable small">
          <div className="card-image">
            <cloudinaryReact.CloudinaryContext cloudName="elsmore-me">
              <cloudinaryReact.Image publicId={this.props.publicId} title={this.props.name} width="200">
                <cloudinaryReact.Transformation height="500" width="500" crop="thumb" gravity="face"/>
                <cloudinaryReact.Transformation height="150" width="300" crop="fill"/>
                <cloudinaryReact.Transformation overlay="cloudinary_logo" width="100" x="10" y="10" opacity="70" gravity="south_east"/>
              </cloudinaryReact.Image>
            </cloudinaryReact.CloudinaryContext>
            <span className="card-title">{this.props.name}</span>
          </div>
          <div className="card-content">
            <p>This photo could be of anything, but faces help prove a point.</p>
          </div>
          <div className="card-action">
            <a href={viewDetails}>Go Big</a>
          </div>
        </div>;
      }
    }
    var Homepage = React.createClass({
      getInitialState: function() {
        return {
          photos: []
        }
      },

      componentDidMount: function() {
        // Is there a React-y way to avoid rebinding `this`? fat arrow?
        var th = this;
        this.serverRequest =
          axios.get(this.props.source)
            .then(function(result) {
              th.setState({
                photos: result.data
              });
            })
      },

      componentWillUnmount: function() {
        this.serverRequest.abort();
      },

      render: function() {
        return (
          <div className="row">
            {this.state.photos.map(function(photo) {
                return (
                  <div className="col l3 m4 s12" >
                    <PhotoThumb publicId={photo.publicId} name={photo.name}></PhotoThumb>
                  </div>
                );
              })}
          </div>
        )
      }
    });

    ReactDOM.render(
      <div>
        <NavBar></NavBar>
        <div class="outer-outlet container">
          <Homepage source="/images.json"></Homepage>
        </div>
        <SiteFooter></SiteFooter>
      </div>,
      document.getElementById('app-root')
    );
</script>
</body>
</html>
